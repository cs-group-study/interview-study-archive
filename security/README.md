# Security

## ❓XSS, CSRF, SQL Injection에 대해 설명해 주세요.

### XSS(Cross Site Scripting)

#### 정의

피해자가 안전하다고 여기는 사이트에 악의적인 스크립트를 주입해 공격하는 행위

#### 종류

##### Reflected XSS

- 피해자의 입력값을 그대로 보여주는 서비스에서 많이 발생
- 피해자가 스크립트를 직접 실행하도록 하므로 1회성 공격

##### Stored XSS

- 웹 애플리케이션에서 XSS 취약점을 파악하고, 악성 스크립트를 삽입
- 삽입된 스크립트는 데이터베이스에 저장되고, 악성 스크립트가 존재하는 게시글 등을 열람한 사용자들은 쿠키를 탈취당하거나 다른 사이트로 리디렉션 됨
- 사용자가 링크를 클릭하도록 유인할 필요가 없으며 피해자가 악성 코드가 삽입된 웹사이트에 접속하기만을 기다리면 됨

##### DOM XSS

- 악의적인 스크립트가 포함된 URL을 사용자가 요청하고 브라우저가 이를 해석하는 단계에서 발생하는 공격
- 악의적인 스크립트로 인해 클라이언트 측 코드가 원래 의도와는 다르게 실행
- 다른 XSS 공격과는 다르게 서버 측에서 탐지가 어려움

#### 대응법

- 입력값에 대한 검증이 제대로 이루어지지 않아 발생하는 취약점
- 사용자의 모든 입력값에 대해 서버측의 필터링 필요
- PHP의 eregi 함수를 이용하면 XSS 공격에 주로 사용되는 문자들을 필터링 가능
- 주로 스크립트를 실행하기 위한 특수문자(`<`, `>`, `"`, `'`)를 필터링

### CSRF(Cross Site Request Forgery)

#### 정의

사용자(희생자)가 자신의 의지와는 무관하게 공격자가 의도한 행위(수정, 삭제, 등록 등)를 특정 웹사이트에 요청하게 만드는 공격

#### 대응법

- 일반적으로 GET은 방어 대상에 두지 않고 POST, PATCH, DELETE에만 적용

##### Referrer 검증

- Back-end에서 request의 referrer를 확인하여 domain이 일치하는지 검증
- 같은 도메인 내의 페이지에 XSS 취약점이 있는 경우 CSRF 공격에 취약해질 수 있으므로 domain에 더해 페이지까지 일치하는지 검증

##### CSRF 토큰 사용

- 사용자의 세션에 임의의 난수 값을 저장하고 사용자의 요청 마다 해당 난수 값을 포함 시켜 전송
- Back-end에서 요청을 받을 때마다 세션에 저장된 토큰 값과 요청 파라미터에 전달되는 토큰 값이 일치하는 지 검증

### SQL Injection

#### 정의

악의적인 사용자가 보안상의 취약점을 이용하여, 임의의 SQL 문을 주입 및 실행되게 하여 데이터베이스가 비정상적인 동작을 하도록 조작하는 공격

#### 종류

##### Error based SQL Injection

##### Union based SQL Injection

##### Blind SQL Injection

##### Time based SQL

##### Stored Procedure SQL Injection

##### Mass SQL Injection

#### 대응법

##### 입력 값에 대한 검증

- 서버 단에서 화이트리스트 기반으로 검증
  - 블랙리스트 기반으로 검증하게 되면 수많은 차단리스트를 등록해야 하며, 하나라도 빠지면 공격에 성공
- 공백으로 치환(취약한 방법)
  - 공격자가 SESELECTLECT 라고 입력 시, 중간의 SELECT가 공백으로 치환이 되면 SELECT 라는 키워드 완성
  - 공백 대신 공격 키워드와 관계 없는 단어로 치환 필요

##### Prepared Statement 구문사용

- 사용자의 입력 값이 데이터베이스의 파라미터로 들어가기 전에 DBMS가 미리 컴파일 해서 실행하지 않고 대기
- 사용자의 입력 값을 문자열로 인식하게 하여 공격 쿼리가 들어가도, 사용자의 입력은 이미 의미 없는 단순 문자열이므로 전체 쿼리문도 공격자의 의도대로 작동 불가

##### Error Message 노출 금지

- 공격자가 SQL Injection을 수행하기 위해서는 데이터베이스의 정보(테이블명, 컬럼명 등)가 필요
- 데이터베이스 에러 발생 시 따로 처리를 해주지 않았다면, 에러가 발생한 쿼리문과 함께 에러에 관한 내용을 반환
- 테이블명 및 컬럼명 그리고 쿼리문이 노출이 될 수 있기 때문에, 데이터 베이스에 대한 오류발생 시 사용자에게 보여줄 수 있는 페이지를 제작 혹은 메시지박스를 띄우도록 해야 함

##### 웹 방화벽 사용

- 소프트웨어 형: 서버 내에 직접 설치
- 하드웨어 형: 네트워크 상에서 서버 앞 단에 직접 하드웨어 장비로 구성
- 프록시 형: DNS 서버 주소를 웹 방화벽으로 바꾸고 서버로 가는 트래픽이 웹 방화벽을 먼저 거치도록 하는 방법
